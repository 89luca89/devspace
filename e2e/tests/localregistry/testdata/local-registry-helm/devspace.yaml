version: v2beta1
name: local-registry
localRegistry: {}
pipelines:
  dev:
    run: |-
      build_images app

      echo $(get_image app) > get_image.out

      create_deployments app --sequential

      start_dev --all
images:
  app:
    image: my-docker-username/helloworld
    tags:
      - latest
    rebuildStrategy: default
deployments:
  app:
    helm:
      values:
        containers:
          - name: container1
            image: image(app):tag(app)
          - name: container2
            image: my-docker-username/helloworld
          - name: container3
            image: app
dev:
  app:
    imageSelector: my-docker-username/helloworld
    container: container1
hooks:
  - command: |
      echo -n ${runtime.images.app} > app.out
    events: ["after:build"]
  - command: |
      echo -n ${runtime.images.app.image} > app_image.out
    events: ["after:build"]
